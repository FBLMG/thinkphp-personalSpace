<include file='Public/header'/>
      <!--sidebar end-->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
              <!-- page start-->
              <div class="row">
                  <div class="col-lg-12">
                      <section class="panel">
                          <header class="panel-heading">
                              日记发表
                          </header>
                      <!-- 主区 -->
<div class="col-lg-12">
<section class="panel">
  <div class="panel-body">
    <form class="form-horizontal tasi-form" method="get">
        <div class="form-group">
          <label class="col-sm-2 control-label">标题</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="title" name="title">
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">描述</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="describe" name="describe">
            <span class="help-block">建议不超过50字</span>
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">封面</label>
          <div class="col-sm-10">
        <!-- 存放照片 -->
        <div class="ibox-content">
          <div class="row">
            <div id="crop-avatar" class="col-md-6">
              <div class="avatar-view" style="width:60px;height:60px">
                <input  id="img" name="img" type="hidden" value="">
                <input  id="aspectRatio" type="hidden" value="1">
                <input  id="img_root_url" type="hidden" value="__PUBLIC__/img/uploads/fileimg">
                <img src="__PUBLIC__/img/uploads/fileimg/noimg.jpg" alt="点击修改图片" style="width:70px;height:70px">
              </div>
            </div>
          </div>
      </div>
        <!-- 存放照片 -->
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">分类</label>
          <div class="col-sm-10">
        <!-- 分类 -->
            <select class="form-control m-bot15" name="type" id="type">
              <volist name="data"  id="vo">
                <option value="{$vo.id}">{$vo.type}</option>
              </volist>         
            </select>
        <!-- 分类 -->
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">状态</label>
          <div class="col-sm-10">
        <!-- 分类 -->
            <select class="form-control m-bot15" name="status" id="status">
                <option value="1">公开</option>
                <option value="0">私有</option>
            </select>
        <!-- 分类 -->
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-2 control-label">内容</label>
          <div class="col-sm-10">
        <!-- 内容 -->
            <textarea id="content" name="content">
            </textarea>
        <!-- 内容 -->
          </div>
        </div>
        <div class="form-group">
          <div class="col-lg-10" style="text-align: center;">
        <!-- 按钮组 -->
            <button type="button" class="btn btn-success" onclick="addarticle()">发表</button>
            <button type="reset" class="btn btn-warning">重置</button>
        <!-- 按钮组 -->
          </div>
        </div>
    </form>
  </div>
</section>
</div>
                      <!-- 主区 -->
                      </section>
                  </div>
              </div>
              <!-- page end-->
          </section>
      </section>
      <!--main content end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="__PUBLIC__/admin/js/jquery.js"></script>
    <script src="__PUBLIC__/admin/js/bootstrap.min.js"></script>
    <script src="__PUBLIC__/admin/js/jquery.scrollTo.min.js"></script>
    <script src="__PUBLIC__/admin/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script type="text/javascript" src="__PUBLIC__/adminassets/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="__PUBLIC__/adminassets/data-tables/DT_bootstrap.js"></script>


    <!--common script for all pages-->
    <script src="__PUBLIC__/admin/js/common-scripts.js"></script>

    <!--script for this page only-->
    <script src="__PUBLIC__/admin/js/dynamic-table.js"></script>
<!---头像模态框---->
<link href="__PUBLIC__/img_cut_upload/css/cropper.min.css" rel="stylesheet">
<link href="__PUBLIC__/img_cut_upload/css/sitelogo.css" rel="stylesheet">
<script src="__PUBLIC__/img_cut_upload/js/cropper.min.js"></script>
<script src="__PUBLIC__/img_cut_upload/js/sitelogo.js"></script>
<div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-lg"  style="width:1000px;">
    <div class="modal-content">
      <form class="avatar-form" action="{:U('Article/postimg')}" enctype="multipart/form-data" method="post">
        <div class="modal-header">
          <button class="close" data-dismiss="modal" type="button">&times;</button>
          <h4 class="modal-title" id="avatar-modal-label">日记封面</h4>
        </div>
        <div class="modal-body">
          <div class="avatar-body">
            <div class="avatar-upload">
              <input class="avatar-src" name="avatar_src" id="avatar_src" type="hidden">
              <input class="avatar-data" name="avatar_data" type="hidden">
              <label for="avatarInput">图片上传</label>
              <input class="avatar-input" id="avatarInput" name="avatar_file" type="file" style="display:none;"></div>
              <img src="__PUBLIC__/images/shangchuang.png" onclick="$('#avatarInput').click();">
            <div class="row">
              <div class="col-md-9">
                <div class="avatar-wrapper"></div>
              </div>
              <div class="col-md-3">
                <div class="avatar-preview preview-lg"></div>
                <div class="avatar-preview preview-md"></div>
                <div class="avatar-preview preview-sm"></div>
              </div>
            </div>
            <div class="row avatar-btns">
              <div class="col-md-9">
                <div class="btn-group">
                  <button class="btn" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees"><i class="fa fa-undo"></i> 向左旋转</button>
                </div>
                <div class="btn-group">
                  <button class="btn" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees"><i class="fa fa-repeat"></i> 向右旋转</button>
                </div>
              </div>
              <div class="col-md-3">
                <button class="btn btn-success btn-block avatar-save" type="submit"><i class="fa fa-save"></i> 保存修改</button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>
<!---头像模态框-->
<!--弹框样式-->
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/layer/skin/layer.css">
  <script src="__PUBLIC__/layer/layer.js"></script>
<!--弹框样式-->
<!-- 密码修改 -->
<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
       <!--  -->
      <section class="panel">
        <header class="panel-heading">
                              密码修改
        </header>
        <div class="panel-body">
          <form class="form-horizontal" role="form">
            <div class="form-group">
              <label for="inputEmail1" class="col-lg-2 control-label">密码</label>
              <div class="col-lg-10">
               <input type="password" class="form-control" id="pwd" name="pwd" placeholder="密码">
              </div>
            </div>
            <div class="form-group">
              <label for="inputPassword1" class="col-lg-2 control-label">重复密码</label>
              <div class="col-lg-10">
                <input type="password" class="form-control" id="pwds" name="pwds" placeholder="重复密码">
              </div>
            </div>
            <div class="form-group">
              <div class="col-lg-offset-2 col-lg-10">
                <button type="button" class="btn btn-danger" onclick="editpwd()">修改</button>
              </div>
            </div>
          </form>
        </div>
      </section>
       <!--  -->
    </div>
  </div>
</div>
<script type="text/javascript">
    function editpwd(){
      var pwd=$('#pwd').val();
      var pwds=$('#pwds').val();
      var ajaxeditpwdUrl='{:U("Index/editpwd")}'; 
      if((pwd=='')||(pwds=='')){
          layer.msg('密码不允许为空');
      }
      if((pwd!='')&&(pwds!='')){
          if(pwd!=pwds){
            layer.msg('两次密码不一致');
          }else{
        /*ajax提交*/
        $.ajax({
      //提交数据的类型 POST GET
        type: "POST",
      //提交的网址
        url: ajaxeditpwdUrl,
      //提交的数据
        data: {pwd:pwd},
      //返回数据的格式
        datatype: "json",
      //成功返回之后调用的函数
        success: function (data) {
      ////根据ajax返回参数判断验证码发送情况
        if(data['status']=="1"){
            layer.msg('修改成功!'); 
            window.location.href="{:U('/Admin/Login/login')}";
        }else{
            layer.msg('没有修改！');   
        }
      ////根据ajax返回参数判断验证码发送情况
        }
     });
        /*ajax提交*/ 
          }
      }
    }
</script>
<!-- 密码修改 -->
<!-- 配置文件 -->
<script type="text/javascript" src="__PUBLIC__/admin/ueditor/ueditor.config.js"></script>
<!-- 编辑器源码文件 -->
<script type="text/javascript" src="__PUBLIC__/admin/ueditor/ueditor.all.js"></script>
<script type="text/javascript">
      $(function(){
        var ue = UE.getEditor('content',{
            elementPathEnabled :false,
            autoHeightEnabled: false,
            "initialFrameHeight" : 250,
        });
      });
</script>
<script type="text/javascript">
    function addarticle(){
       var filename=$('#title').val();
       var describe=$('#describe').val();
       var content=UE.getEditor('content').getContent();
       var status=$('#status').val();
       var fid=$('#type').val();
       var ajaxarticleUrl='{:U("Article/addfile")}'; 
       if(filename==''){
          layer.msg('亲，请填写标题！');
          return false;
       }
       if(describe==''){
          layer.msg('亲，请填写描述！');
          return false;
       }
       if(content==''){
          layer.msg('亲，请填写内容！');
          return false;
       }
    /**ajax提交**/ 
    $.ajax({
      //提交数据的类型 POST GET
        type: "POST",
      //提交的网址
        url: ajaxarticleUrl,
      //提交的数据
        data: {filename: filename,describe:describe,content:content,status:status,fid:fid},
      //返回数据的格式
        datatype: "json",
      //成功返回之后调用的函数
        success: function (data) {
      ////根据ajax返回参数判断验证码发送情况
        if(data['status']=="1"){
            layer.msg('发表成功!'); 
            window.location.reload();
        }else{
            layer.msg('发表失败!');   
        }
      ////根据ajax返回参数判断验证码发送情况
        }
     });
    /**ajax提交**/ 
    }
</script>
  </body>
</html>
